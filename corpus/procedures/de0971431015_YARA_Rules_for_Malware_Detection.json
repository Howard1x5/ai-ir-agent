{
  "id": "de0971431015",
  "title": "YARA Rules for Malware Detection",
  "content": "\n# Writing YARA Rules for Malware Detection\n\n## Basic Rule Structure\n```yara\nrule MalwareName {\n    meta:\n        description = \"Detects MalwareName\"\n        author = \"Your Name\"\n        date = \"2024-01-01\"\n        hash = \"sha256_of_sample\"\n\n    strings:\n        $s1 = \"suspicious string\"\n        $s2 = { 4D 5A 90 00 }  // hex bytes\n        $s3 = /http:\\/\\/[a-z]+\\.(com|net)/ // regex\n\n    condition:\n        uint16(0) == 0x5A4D and  // MZ header\n        any of ($s*)\n}\n```\n\n## String Types\n- Text: $s = \"string\"\n- Wide: $s = \"string\" wide\n- ASCII+Wide: $s = \"string\" ascii wide\n- Hex: $s = { 4D 5A }\n- Regex: $s = /pattern/\n\n## Useful Conditions\n- filesize < 1MB\n- uint16(0) == 0x5A4D (PE file)\n- pe.imports(\"kernel32.dll\", \"VirtualAlloc\")\n- pe.sections[0].name == \".text\"\n- #s1 > 5 (string count)\n- @s1 < 0x1000 (string offset)\n\n## PE Module Conditions\n```yara\nimport \"pe\"\n\nrule SuspiciousPE {\n    condition:\n        pe.number_of_sections > 7 and\n        pe.imports(\"ws2_32.dll\") and\n        pe.characteristics & pe.DLL\n}\n```\n\n## Common Detection Patterns\n1. Anti-VM strings\n2. Known C2 URLs/IPs\n3. Unique error messages\n4. Mutex names\n5. PDB paths\n6. Unusual API combinations\n7. Shellcode patterns\n\n## Testing Rules\n```bash\nyara -r rule.yar /path/to/samples/\nyara -s rule.yar sample.exe  # show matching strings\n```\n\n## Avoiding False Positives\n- Use multiple conditions\n- Be specific with strings\n- Test against known-good files\n- Use filesize limits\n",
  "source": "generated_procedure",
  "source_type": "procedure",
  "url": null,
  "metadata": {
    "quality": "high"
  }
}